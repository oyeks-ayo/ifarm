{% extends 'admin/admin.html' %}

{% block content %}
       <div class="my-5">
        {% set messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} 
                        alert-dismissible fade show mx-5" role="alert">
                  {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
      
        {% endif %}
      </div>

       
       <div>
        <form action="{{url_for('delete_product')}}" method="post">
          <input type="hidden" name="csrf_token" value="{{csrf_token()}}">
          <table class="table table-striped table-warning">
            <thead>
              <tr>
                <th>s/n</th><th>Product Name</th><th>Price</th><th>Category</th><th>Quantity</th><th>Status</th><th>Image</th><th>Action</th>
              </tr>
            </thead>
              
              <tbody>
                {% for p in products %}
                <input type="hidden" name = 'id' value="{{p.prod_id}}">
                <tr>
                  <td>{{ loop.index }}</td><td>{{p.prod_name}}</td><td>{{p.amount}}</td><td>{{p.category}}</td><td>{{p.quantity}}</td><td>{{p.status}}</td>
                  <td>
                    {% for img in p.images %}
                    <img class="img-thumbnail rounded" src="/static/products/{{img.filename}}" alt="tiles" width="80">
                    {% endfor %}
                  </td>
                  <td>
                    <button class="btn btn-danger btn-small" type='submit'>Delete Product</button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
              
          </table>
        </form>
       </div>

        <div class="form form-control">
          <form action="{{url_for('update_product')}}" method="post" enctype="multipart/form-data">
            {{form.csrf_token}}
            <div class="mt-5">
                <select name="id" id="" class="form-control">
                  <option value="">Product</option>
                  {% for p in products %}
                  <option value="{{p.prod_id}}">{{p.prod_name}}</option>
                  {% endfor %}
                </select>
              </div>

            <div class="mt-5">
              {{form.price.label}}
              {{form.price(class_='form-control',placeholder='Price')}}
            </div>

            <div class="mt-5">
              <select name="category" id="" class="form-control">
                <option value="">Category</option>
                {% for c in category %}
                <option value="{{c.cat_name}}">{{c.cat_name}}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mt-5">
              {{form.quantity.label}} <br>
              {{form.quantity(class_='form-control', placeholder='quantity')}}
            </div>

            <div class="mt-5">
              {{form.image.label}} <br>
              {{form.image(multiple=True, accept="image/*")}}
              {% if form.image.errors %}
                    {% for error in form.image.errors %}
                        <span class="error-message">{{error}}</span>
                    {% endfor %}
                {% endif %}
            </div>

            <div class="mt-5">
              {{ form.status.label }} <br>
              {% for subfield in form.status %}
                  <div class="form-check form-check-inline">
                      {{ subfield(class="form-check-input") }}
                      {{ subfield.label(class="form-check-label") }}
                  </div>
              {% endfor %}
          </div>
          

            <div class="mt-5">
              <button class="btn btn-dark form-control" type="submit">Update Product</button>
            </div>
            
          </form>
        </div>
       {% endblock %}